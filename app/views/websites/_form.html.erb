<script type="text/javascript">
  <%= render 'websites/edit.js' %>
</script>

<div class="row" id="website_form" ng-controller="WebsiteController as webCtrl" >
  <div class="col-sm-12">
    <% if website.errors.any? %>
    <div class="alert alert-danger">
      <strong><%= pluralize(website.errors.count, "error") %> prohibited this website from being saved:</strong>
      <ul>
        <% website.errors.full_messages.each do |message| %>
        <li><%= message %></li>
        <% end %>
      </ul>
    </div>
    <% end %>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Website Info</a></li>
      <li role="presentation"><a href="#hero" aria-controls="home" role="tab" data-toggle="tab">Front Page Hero Images</a></li>
      <li role="presentation"><a href="#site" aria-controls="site" role="tab" data-toggle="tab">Site wide</a></li>
    </ul>
    <%= form_for(website) do |f| %>

    <div class="tab-content">
      <!-- Home tab content -->
      <div role="tabpanel" class="tab-pane active" id="home">
        <br/>
        </fieldset>
        <div class="form-group" id="name">
          <%= f.label :name %>
          <%= f.text_field :name, class: 'form-control' %>
        </div>

        <div class="form-group" id="about">
          <%= f.label :about %>
          <%= f.text_area :about, class: 'form-control summernote' %>
        </div>
      </div>

      <!-- Hero tab content -->
      <div role="tabpanel" class="tab-pane" id="hero">
        <br/>

        <fieldset>
          <legend>
            Hero Images
          </legend>
          <div class="row" ng-init="webCtrl.heros = <%= @website.hero_images.to_json %>; webCtrl.website_id = <%= @website.id %>" data-as-sortable="webCtrl.dragControlListeners" ng-model="webCtrl.heros">
            <div class="clearfix" ng-if="$index % 3 == 0">
            </div>
            <span class="col-sm-12" ng-repeat="hero in webCtrl.heros" data-as-sortable-item data-id='{{hero.id}}'>
              <div class="hero_image_{{hero.id}}">
                <div class="panel panel-default">
                  <div class="panel-body">
                    <div class="row">
                      <div class="col-sm-4">
                        <div data-as-sortable-item-handle>
                          <img ng-src="{{hero.medium}}" alt="{{hero.name}}" />
                          <label class="label label-success" ng-show="$first">Active</label>
                        </div>
                      </div>
                      <div class="col-sm-8">
                        <div class="row">
                          <div class="col-sm-9">
                            <div class="form-group">
                              <input type="text"
                                     name="title"
                                     ng-model="hero.name"
                                     ng-blur="webCtrl.save_hero(hero)"
                                     class="form-control"
                                     placeholder="Title"/>
                            </div>
                          </div>
                          <div class="col-sm-3">
                            <button type="button" ng-click="webCtrl.destroy_hero(hero)" class="btn btn-danger btn-block">
                              Remove
                            </button>
                          </div>
                        </div>
                          <div class="form-group">
                            <input type="text"
                                      name="sub_title"
                                      ng-blur="webCtrl.save_hero(hero)"
                                      ng-model="hero.about"
                                      class="form-control"
                                      placeholder="Subtitle"/>
                          </div>
                          <div class="row">
                            <div class="col-sm-6">
                              <div class="form-group">
                                <input  type="text"
                                        name="link"
                                        ng-blur="webCtrl.save_hero(hero)"
                                        ng-model="hero.link"
                                        class="form-control"
                                        placeholder="Link"/>

                              </div>
                            </div>
                            <div class="col-sm-6">
                              <div class="form-group">
                                <input  type="text"
                                        name="link"
                                        ng-blur="webCtrl.save_hero(hero)"
                                        ng-model="hero.link_text"
                                        class="form-control"
                                        placeholder="Link text"/>

                              </div>
                            </div>
                          </div>
                      </div>

                    </div>
                  </div>

                </div>
              </div>
            </span>

          </div>
          <button type="button" class="btn btn-primary" ngf-select="webCtrl.uploadFiles($files, $invalidFiles, '/hero_images.json', 'HeroImage', 'Website', webCtrl.website_id, webCtrl.heros)" multiple
                  accept="image/*" ngf-max-size="10MB">
              Select Files</button>
          <br/><br/>
          <div>
            <div ng-if="!f.result" ng-repeat="f in files['HeroImage'+webCtrl.website_id]">{{f.name}} {{f.$errorParam}}
              <div class="progress">
                <div class="progress-bar" role="progressbar" style="width:{{f.progress}}%">
                  <span class="sr-only"></span>
                </div>
              </div>
            </div>
            <div ng-repeat="f in errFiles['HeroImage'+webCtrl.website_id]" class="alert alert-danger">{{f.name}} {{f.$error}} {{f.$errorParam}}
            </div>
          </div>
      </div>

      <!-- Site tab content -->
      <div role="tabpanel" class="tab-pane" id="site">
        <br/>
        <fieldset ng-init="webCtrl.logo = <%= @website.logo.to_json %>;">
          <legend>
            Logo
          </legend>
          <div class="form-group">
            <div>
              <div class="text-center">
                <button type="button" class="btn btn-primary" ngf-select="webCtrl.uploadFiles($files, $invalidFiles, '/logos.json', 'Logo', 'Website', webCtrl.website_id, baseCtrl.website.logo)"
                        accept="image/*" ngf-max-size="10MB">
                    Upload Logo</button>
              </div>
              <br/>
              <div ng-if="!f.result" ng-repeat="f in files['Logo'+webCtrl.website_id]">{{f.name}} {{f.$errorParam}}
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width:{{f.progress}}%">
                    <span class="sr-only"></span>
                  </div>
                </div>
              </div>
              <div ng-repeat="f in errFiles['Logo'+webCtrl.website_id]" class="alert alert-danger">{{f.name}} {{f.$error}} {{f.$errorParam}}
              </div>
            </div>

            <div id="logo" class="logo thumbnail">
              <img ng-src="{{baseCtrl.website.logo.medium}}" alt="Logo" ng-show='baseCtrl.website.logo.medium'/>
              <%= image_tag @website.logo.medium, ng_hide: 'baseCtrl.website.logo.medium' %>
            </div>

            <%# link_to 'Remove Logo', logo_path(@website.logo), method: :delete, class: 'btn btn-danger', remote: true if @website.logo.asset.present? %>
          </div>

        </fieldset>
        <div class="form-group">
          <legend>
            Account
          </legend>
          <%= f.select :account_id, current_user.accounts.collect {|x| [x.id, x.id]}, {}, :multiple => false, :class => 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :css_override %>
          <%= f.text_area :css_override, rows: '6', class: 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :domain_url %>
          <%= f.text_field :domain_url, class: 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :google_analytics %>
          <%= f.text_field :google_analytics, class: 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :facebook %>
          <%= f.text_field :facebook, class: 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :twitter %>
          <%= f.text_field :twitter, class: 'form-control' %>
        </div>

        <div class="form-group">
          <%= f.label :tags %>
          <%= f.text_field :tags, class: 'form-control' %>
        </div>
        <div class="form-group">
          <%= f.label :theme %>
          <%= f.text_field :theme, class: 'form-control' %>
        </div>

      </div>
      <hr/>
    </div>
    <div class="form-group">
      <%= f.submit 'Save Website', class: 'btn btn-success btn-lg' %>
      <%= link_to 'Cancel', @website, class: "btn btn-default btn-lg" %>
    </div>
    <% end %>
  </div>

</div>

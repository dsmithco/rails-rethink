<% cache [@current_website.pages, current_user, @page, @page.try(:pages)] do %>
  <% @current_website.pages.where(page_id: [nil,''], show_in_menu: [false,nil]).each do |page| %>
    <% if page.pages.present? %>
      <li class='dropdown <%= "active" if page.id == @page.try(:id) || page.try(:page_ids).include?(@page.try(:id))%>'>
        <%= link_to "#{page.name} <span class='caret'></span>".html_safe, page_path(page, 'redirect'), class: 'dropdown-toggle', 'data-toggle': '' %>
        <ul class="dropdown-menu">
          <% page.pages.where(show_in_menu: [false,nil]).each do |page2| %>
            <li class="<%= "active" if page2.id == @page.try(:id)%>">
              <%= link_to page2.name, page_path(page2, 'redirect') %>
            </li>
          <% end %>
        </ul>
      </li>
    <% else %>
      <li class="<%= "active" if page.id == @page.try(:id) %>">
        <%= link_to page.name, page_path(page, 'redirect') %>
      </li>
    <% end %>
  <% end %>
<% end %>
<% if user_signed_in? %>
  <li>
      <%= link_to "<i class='glyphicon glyphicon-plus'></i>".html_safe, new_website_page_path(@current_website) %>
  </li>
  <li>
    <button class="btn btn-primary dropdown-toggle navbar-btn" type="button" data-toggle="dropdown"><%= current_user.name %>
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li>
        <%= link_to "<i class='glyphicon glyphicon-user fa-fw'></i> Account".html_safe, user_path(current_user) %>
      </li>
      <li>
        <%= link_to "<i class='fa fa-pencil fa-fw'></i> Edit #{@current_website.name}".html_safe, edit_website_path(@current_website) %>
      </li>
      <li class="divider"></li>
      <li>
        <%= link_to "<i class='fa fa-sign-out fa-fw'></i> <span>Sign out</span>".html_safe, destroy_user_session_path %>
      </li>
    </ul>
  </li>
<% end %>

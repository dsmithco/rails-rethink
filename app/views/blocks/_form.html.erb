<%= form_for(block, remote: (remote||false)) do |f| %>

<div class="modal-header">
  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
  <h4 class="modal-title">Block</h4>
</div>
  <div class="modal-body">


  <% if block.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(block.errors.count, "error") %> prohibited this block from being saved:</h2>

      <ul>
      <% block.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group" id="front_page">
    <label class="btn btn-default"><%= f.check_box :front_page, autocomplete: "off", id: 'front_page_input' %> Show on the front page</label>
    <script>
      var check_box = $('#front_page_input');
      function check_checkbox(){
        var parent = $(this).parent();
        var active_class = "btn-primary";
        this.checked ? parent.addClass(active_class) : parent.removeClass(active_class);
      }
      check_box.change(check_checkbox).change();
    </script>
  </div>

  <div class="form-group" id="block_type">
    <label>Block Type</label>
    <%= f.select :block_type, Block::BLOCK_TYPES, {:include_blank => "-- Select a type --"}, :class => 'form-control' %>
    <script>
      var block_block_type = $('#block_block_type');
      var default_options = <%= Block::REGIONS.to_json.html_safe %>;
      var main_options = <%= Block::CONTENT_REGIONS.to_json.html_safe %>;

      function set_options(){
        var location_select = $('#location select');
        location_select.empty();
        if(['container'].indexOf(block_block_type.val())>-1){
          main_options.forEach(function(option){
            location_select.append("<option>" + option + "</option>");
          })
        }else{
          default_options.forEach(function(option){
            location_select.append("<option>" + option + "</option>");
          })
        }
      }

      function hide_navigation_fields(){
        var name_about = $('#name, #about');
        if(block_block_type.val() == 'navigation'){
          name_about.hide();
        }else{
          name_about.show();
        }
      }

      block_block_type.change(set_options);
      block_block_type.change(hide_navigation_fields);
      block_block_type.change(); // init change

    </script>


    </script>
  </div>


  <div class="form-group" id="location">
    <label>Location</label>
    <%= f.select :location, Block::REGIONS, {:include_blank => "-- Select a location --"}, :class => 'form-control' %>
    </select>
  </div>

  <div class="form-group" id="name">
    <%= f.label :name %>
    <%= f.text_field :name, class: 'form-control' %>
  </div>

  <div class="form-group" id="about">
    <%= f.label :about %>
    <%= f.text_area :about, class: 'form-control' %>
  </div>

  <div class="form-group" id="position">
    <label>Default Position</label>
    <%= f.text_field :position, class: 'form-control' %>
  </div>


  <div class="form-group" id="position">
    <label>Container Block</label>
    <%= f.select :block_id, @current_website.blocks.where(block_type: 'container').collect {|x| [x.name, x.id]}, {:include_blank => "-- No container --"}, :class => 'form-control' %>
  </div>
</div>
<div class="modal-footer">
  <div class="">
    <%= f.submit 'Save', class: 'btn btn-success' %>
  </div>
</div>

<% end %>

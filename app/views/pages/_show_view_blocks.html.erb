<% content_for :page_blocks do %>
  <%= content_tag('div', "#{render 'blocks/main_blocks', blocks: @page.blocks}".html_safe, data: {location: 'bottom'}, id: 'page_blocks', class: 'bottom_container main-sortable-connect') %>
  <script type="text/javascript">
    $( ".main-sortable-connect" ).sortable();
    $( ".main-sortable-connect" ).sortable({
      handle: '.block-handle',
      connectWith: ".main-sortable-connect",
      placeholder: "ui-state-highlight"
    });
    $( ".main-sortable-connect" ).on( "sortupdate", function( event, ui ) {
      console.log(event);
      console.log(ui);
      var id,url,position,item;
      id = ui.item.context.dataset.id;
      url = "/blocks/" + id + ".js";
      position = $(ui.item).index() + 1;
      item = {block:{'position': position, 'id': id}};
      $.ajax({
          url: url,
          type: 'PUT',
          data: item,
          success: function(result) {
              // Do something with the result
          }
      });
    });
  </script>

<% end %>
